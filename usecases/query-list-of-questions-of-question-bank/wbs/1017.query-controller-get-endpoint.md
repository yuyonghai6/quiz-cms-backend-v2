# User Story 1017: Query Controller with GET Endpoint

## User Story

**As a** frontend developer
**I want** a REST API endpoint to query questions with filters and pagination
**So that** I can retrieve and display questions to users

## Acceptance Criteria

- [ ] Orchestration-layer POM updated with question-bank-query module dependency
- [ ] Component scanning configured to include questionbankquery package
- [ ] GET endpoint created at `/api/v1/users/{userId}/question-banks/{questionBankId}/questions`
- [ ] Controller accepts query parameters (categories, tags, quizzes, searchText, page, size, sortBy, sortDirection)
- [ ] Controller uses mediator to send query
- [ ] Controller returns 200 OK with questions and pagination metadata
- [ ] Controller returns 200 OK with empty list when no matches (not 404)
- [ ] Controller returns 400 BAD REQUEST for validation errors
- [ ] Controller returns 500 INTERNAL SERVER ERROR for unexpected errors
- [ ] Integration tests verify all HTTP scenarios
- [ ] All tests pass with JaCoCo coverage > 70%
- [ ] Allure annotations correctly applied

---

## TDD Cycle

### Allure Annotations Format

```java
@Epic("Use Case Query List of Questions of Question Bank")
@Story("1017.query-controller-get-endpoint")
```

---

## Phase 1: RED (Write Failing Tests)

### Objective
Write failing integration tests for REST controller.

### Tasks

#### Task 1.1: Update Orchestration Layer POM with Query Module Dependency

Ensure `question-bank-query` module dependency exists in `orchestration-layer/pom.xml`:

```xml
<dependency>
    <groupId>com.quizfun</groupId>
    <artifactId>question-bank-query</artifactId>
    <version>${project.version}</version>
</dependency>
```

**Why in RED Phase**: This dependency is required for tests to compile. Tests import DTOs, documents, and query classes from the query module.

#### Task 1.2: Update Component Scanning Configuration

**File**: Update `orchestration-layer/src/main/java/com/quizfun/orchestrationlayer/OrchestrationLayerApplication.java`

```java
@SpringBootApplication(scanBasePackages = {
    "com.quizfun.orchestrationlayer",
    "com.quizfun.internallayer",
    "com.quizfun.globalshared",
    "com.quizfun.questionbank",
    "com.quizfun.questionbankquery"  // Add query module
})
```

**Why in RED Phase**: Component scanning must include the query module package so Spring can discover and register query handlers. Without this, the mediator cannot route queries to handlers, and tests will fail with "No handler registered" errors.

#### Task 1.3: Create Controller Integration Tests

**File**: `orchestration-layer/src/test/java/com/quizfun/orchestrationlayer/controllers/QueryQuestionsControllerIntegrationTest.java`

```java
package com.quizfun.orchestrationlayer.controllers;

import com.quizfun.questionbankquery.infrastructure.persistence.documents.QuestionDocument;
import com.quizfun.questionbankquery.infrastructure.persistence.documents.TaxonomyDocument;
import io.qameta.allure.Epic;
import io.qameta.allure.Story;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.test.context.DynamicPropertyRegistry;
import org.springframework.test.context.DynamicPropertySource;
import org.springframework.test.web.servlet.MockMvc;
import org.testcontainers.containers.MongoDBContainer;
import org.testcontainers.junit.jupiter.Container;
import org.testcontainers.junit.jupiter.Testcontainers;

import java.time.Instant;
import java.util.List;

import static org.hamcrest.Matchers.*;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@Epic("Use Case Query List of Questions of Question Bank")
@Story("1017.query-controller-get-endpoint")
@Testcontainers
@SpringBootTest
@AutoConfigureMockMvc
@ActiveProfiles("test")
@DisplayName("Query Questions Controller Integration Tests")
class QueryQuestionsControllerIntegrationTest {

    private static final int MONGO_INTERNAL_PORT = 27018;

    @Container
    static MongoDBContainer mongoContainer = new MongoDBContainer("mongo:8.0")
            .withExposedPorts(MONGO_INTERNAL_PORT)
            .withReuse(false);

    @DynamicPropertySource
    static void mongoProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.data.mongodb.uri", mongoContainer::getReplicaSetUrl);
        registry.add("spring.data.mongodb.read-preference", () -> "primary");
    }

    @Autowired
    private MockMvc mockMvc;

    @Autowired
    private MongoTemplate mongoTemplate;

    private static final Long TEST_USER_ID = 12345L;
    private static final Long TEST_QUESTION_BANK_ID = 67890L;
    private static final String COLLECTION_NAME = "questions";
    private static final String BASE_URL = "/api/v1/users/{userId}/question-banks/{questionBankId}/questions";

    @BeforeEach
    void setUp() {
        mongoTemplate.dropCollection(COLLECTION_NAME);
        mongoTemplate.createCollection(COLLECTION_NAME);
        insertTestQuestions();
    }

    @AfterEach
    void tearDown() {
        mongoTemplate.dropCollection(COLLECTION_NAME);
    }

    @Test
    @DisplayName("Should return 200 OK with questions and pagination")
    void shouldReturn200OKWithQuestionsAndPagination() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("page", "0")
                        .param("size", "10"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(10)))
                .andExpect(jsonPath("$.pagination.currentPage", is(0)))
                .andExpect(jsonPath("$.pagination.pageSize", is(10)))
                .andExpect(jsonPath("$.pagination.totalItems", is(20)))
                .andExpect(jsonPath("$.pagination.totalPages", is(2)));
    }

    @Test
    @DisplayName("Should filter by categories")
    void shouldFilterByCategories() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("categories", "Math"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(10)))
                .andExpect(jsonPath("$.questions[0].taxonomy.categories", hasItem("Math")));
    }

    @Test
    @DisplayName("Should filter by tags")
    void shouldFilterByTags() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("tags", "algebra"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(greaterThan(0))))
                .andExpect(jsonPath("$.questions[0].taxonomy.tags", hasItem("algebra")));
    }

    @Test
    @DisplayName("Should filter by quizzes")
    void shouldFilterByQuizzes() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("quizzes", "midterm-2024"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(greaterThan(0))))
                .andExpect(jsonPath("$.questions[0].taxonomy.quizzes", hasItem("midterm-2024")));
    }

    @Test
    @DisplayName("Should search by text")
    void shouldSearchByText() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("searchText", "equation"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(greaterThan(0))))
                .andExpect(jsonPath("$.questions[0].questionText", containsString("equation")));
    }

    @Test
    @DisplayName("Should combine multiple filters")
    void shouldCombineMultipleFilters() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("categories", "Math")
                        .param("tags", "algebra")
                        .param("searchText", "equation"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(greaterThan(0))));
    }

    @Test
    @DisplayName("Should return 200 OK with empty list when no matches")
    void shouldReturn200OKWithEmptyListWhenNoMatches() throws Exception {
        mockMvc.perform(get(BASE_URL, 99999L, TEST_QUESTION_BANK_ID))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(0)))
                .andExpect(jsonPath("$.pagination.totalItems", is(0)))
                .andExpect(jsonPath("$.pagination.totalPages", is(0)));
    }

    @Test
    @DisplayName("Should support pagination with page and size")
    void shouldSupportPaginationWithPageAndSize() throws Exception {
        // First page
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("page", "0")
                        .param("size", "5"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(5)))
                .andExpect(jsonPath("$.pagination.currentPage", is(0)))
                .andExpect(jsonPath("$.pagination.totalPages", is(4)));

        // Second page
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("page", "1")
                        .param("size", "5"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(5)))
                .andExpect(jsonPath("$.pagination.currentPage", is(1)));
    }

    @Test
    @DisplayName("Should support sorting by createdAt")
    void shouldSupportSortingByCreatedAt() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("sortBy", "createdAt")
                        .param("sortDirection", "asc"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(greaterThan(0))));
    }

    @Test
    @DisplayName("Should support sorting by questionText")
    void shouldSupportSortingByQuestionText() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("sortBy", "questionText")
                        .param("sortDirection", "asc"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions", hasSize(greaterThan(0))));
    }

    @Test
    @DisplayName("Should use default values when params not provided")
    void shouldUseDefaultValuesWhenParamsNotProvided() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.pagination.currentPage", is(0)))
                .andExpect(jsonPath("$.pagination.pageSize", is(20)));
    }

    @Test
    @DisplayName("Should return 400 BAD REQUEST for invalid page number")
    void shouldReturn400BadRequestForInvalidPageNumber() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("page", "-1"))
                .andExpect(status().isBadRequest());
    }

    @Test
    @DisplayName("Should return 400 BAD REQUEST for invalid page size")
    void shouldReturn400BadRequestForInvalidPageSize() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("size", "150"))
                .andExpect(status().isBadRequest());
    }

    @Test
    @DisplayName("Should include all question fields in response")
    void shouldIncludeAllQuestionFieldsInResponse() throws Exception {
        mockMvc.perform(get(BASE_URL, TEST_USER_ID, TEST_QUESTION_BANK_ID)
                        .param("page", "0")
                        .param("size", "1"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.questions[0].questionId", notNullValue()))
                .andExpect(jsonPath("$.questions[0].questionText", notNullValue()))
                .andExpect(jsonPath("$.questions[0].questionType", notNullValue()))
                .andExpect(jsonPath("$.questions[0].createdAt", notNullValue()))
                .andExpect(jsonPath("$.questions[0].updatedAt", notNullValue()));
    }

    // Helper method

    private void insertTestQuestions() {
        Instant now = Instant.now();
        for (int i = 0; i < 20; i++) {
            TaxonomyDocument taxonomy = TaxonomyDocument.builder()
                    .categories(List.of("Math", "Algebra"))
                    .tags(List.of("algebra", "equations"))
                    .quizzes(List.of("midterm-2024"))
                    .build();

            QuestionDocument doc = QuestionDocument.builder()
                    .questionId(5000000000000L + i)
                    .userId(TEST_USER_ID)
                    .questionBankId(TEST_QUESTION_BANK_ID)
                    .questionText("Solve the equation for x: " + i)
                    .questionType("MCQ")
                    .difficultyLevel("EASY")
                    .taxonomy(taxonomy)
                    .createdAt(now.minusSeconds(100 - i))
                    .updatedAt(now.minusSeconds(100 - i))
                    .build();

            mongoTemplate.insert(doc, COLLECTION_NAME);
        }
    }
}
```

#### Task 1.4: Run Tests (Should FAIL)

```bash
mvn clean test -pl orchestration-layer -Dtest=QueryQuestionsControllerIntegrationTest
```

**Expected Result**: Tests should FAIL because controller doesn't exist yet.

**Verification**:
- ✅ Tests compile successfully (dependencies and imports resolved)
- ✅ Tests fail with "404 Not Found" or similar (controller endpoint missing)
- ❌ Do NOT see "No handler registered" errors (component scanning works)

---

## Phase 2: GREEN (Make Tests Pass)

### Objective
Implement REST controller to make tests pass.

### Tasks

#### Task 2.1: Create Controller

**File**: `orchestration-layer/src/main/java/com/quizfun/orchestrationlayer/controllers/QueryQuestionsController.java`

```java
package com.quizfun.orchestrationlayer.controllers;

import com.quizfun.globalshared.mediator.IMediator;
import com.quizfun.globalshared.mediator.Result;
import com.quizfun.questionbankquery.application.dto.QueryQuestionsRequest;
import com.quizfun.questionbankquery.application.dto.QueryQuestionsResponse;
import com.quizfun.questionbankquery.application.queries.QueryQuestions;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

/**
 * REST controller for querying questions.
 *
 * <p>Endpoint: GET /api/v1/users/{userId}/question-banks/{questionBankId}/questions
 *
 * <p><strong>Query Parameters:</strong>
 * <ul>
 *   <li>categories: List of hierarchical categories (AND logic)</li>
 *   <li>tags: List of tags (OR logic)</li>
 *   <li>quizzes: List of quiz IDs (OR logic)</li>
 *   <li>searchText: Full-text search on question text</li>
 *   <li>page: Page number (zero-indexed, default: 0)</li>
 *   <li>size: Page size (1-100, default: 20)</li>
 *   <li>sortBy: Sort field (createdAt, updatedAt, questionText, default: createdAt)</li>
 *   <li>sortDirection: Sort direction (asc, desc, default: desc)</li>
 * </ul>
 *
 * <p><strong>Responses:</strong>
 * <ul>
 *   <li>200 OK: Success with questions and pagination (or empty list if no matches)</li>
 *   <li>400 BAD REQUEST: Validation error (invalid parameters)</li>
 *   <li>500 INTERNAL SERVER ERROR: Unexpected error</li>
 * </ul>
 */
@Slf4j
@RestController
@RequestMapping("/api/v1/users/{userId}/question-banks/{questionBankId}/questions")
@RequiredArgsConstructor
public class QueryQuestionsController {

    private final IMediator mediator;

    /**
     * Queries questions with filters, pagination, and sorting.
     *
     * @param userId User ID (path variable)
     * @param questionBankId Question Bank ID (path variable)
     * @param categories List of categories for filtering (optional)
     * @param tags List of tags for filtering (optional)
     * @param quizzes List of quiz IDs for filtering (optional)
     * @param searchText Search text for full-text search (optional)
     * @param page Page number (optional, default: 0)
     * @param size Page size (optional, default: 20)
     * @param sortBy Sort field (optional, default: createdAt)
     * @param sortDirection Sort direction (optional, default: desc)
     * @return Response with questions and pagination metadata
     */
    @GetMapping
    public ResponseEntity<?> queryQuestions(
            @PathVariable Long userId,
            @PathVariable Long questionBankId,
            @RequestParam(required = false) List<String> categories,
            @RequestParam(required = false) List<String> tags,
            @RequestParam(required = false) List<String> quizzes,
            @RequestParam(required = false) String searchText,
            @RequestParam(required = false, defaultValue = "0") Integer page,
            @RequestParam(required = false, defaultValue = "20") Integer size,
            @RequestParam(required = false, defaultValue = "createdAt") String sortBy,
            @RequestParam(required = false, defaultValue = "desc") String sortDirection
    ) {
        try {
            log.info("Received query request: userId={}, questionBankId={}, page={}, size={}",
                    userId, questionBankId, page, size);

            // Build request
            QueryQuestionsRequest request = QueryQuestionsRequest.builder()
                    .userId(userId)
                    .questionBankId(questionBankId)
                    .categories(categories)
                    .tags(tags)
                    .quizzes(quizzes)
                    .searchText(searchText)
                    .page(page)
                    .size(size)
                    .sortBy(sortBy)
                    .sortDirection(sortDirection)
                    .build();

            // Send query through mediator
            QueryQuestions query = new QueryQuestions(request);
            Result<QueryQuestionsResponse> result = mediator.send(query);

            if (result.isSuccess()) {
                log.info("Query successful: found {} questions",
                        result.getValue().questions().size());
                return ResponseEntity.ok(result.getValue());
            } else {
                log.warn("Query failed: {}", result.getError());
                return ResponseEntity.badRequest().body(result.getError());
            }

        } catch (Exception e) {
            log.error("Unexpected error querying questions: {}", e.getMessage(), e);
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                    .body("Internal server error: " + e.getMessage());
        }
    }
}
```

#### Task 2.2: Run Tests (Should PASS)

```bash
mvn clean test -pl orchestration-layer -Dtest=QueryQuestionsControllerIntegrationTest
```

**Expected Result**: All 14 controller tests should PASS.

---

## Phase 3: REFACTOR (Improve Code Quality)

### Objective
Add input validation, error handling, and API documentation.

### Tasks

#### Task 3.1: Add Request Validation

Update controller with `@Valid` and constraint annotations:

```java
@GetMapping
public ResponseEntity<?> queryQuestions(
        @PathVariable @Min(1) Long userId,
        @PathVariable @Min(1) Long questionBankId,
        @RequestParam(required = false) List<String> categories,
        @RequestParam(required = false) List<String> tags,
        @RequestParam(required = false) List<String> quizzes,
        @RequestParam(required = false) String searchText,
        @RequestParam(required = false, defaultValue = "0") @Min(0) Integer page,
        @RequestParam(required = false, defaultValue = "20") @Min(1) @Max(100) Integer size,
        @RequestParam(required = false, defaultValue = "createdAt") String sortBy,
        @RequestParam(required = false, defaultValue = "desc") String sortDirection
) {
    // ... existing code
}
```

#### Task 3.2: Add OpenAPI Documentation

Add Swagger/OpenAPI annotations:

```java
@Operation(
    summary = "Query questions with filters and pagination",
    description = "Retrieves questions for a user's question bank with optional filters (categories, tags, quizzes, search text), pagination, and sorting."
)
@ApiResponses(value = {
    @ApiResponse(responseCode = "200", description = "Success - Returns questions with pagination metadata (or empty list if no matches)"),
    @ApiResponse(responseCode = "400", description = "Bad Request - Invalid parameters"),
    @ApiResponse(responseCode = "500", description = "Internal Server Error - Unexpected error")
})
@GetMapping
public ResponseEntity<?> queryQuestions(
    @Parameter(description = "User ID", required = true) @PathVariable Long userId,
    @Parameter(description = "Question Bank ID", required = true) @PathVariable Long questionBankId,
    // ... rest of parameters with @Parameter annotations
) {
    // ... existing code
}
```

#### Task 3.3: Add Exception Handler

**File**: `orchestration-layer/src/main/java/com/quizfun/orchestrationlayer/config/GlobalExceptionHandler.java`

```java
package com.quizfun.orchestrationlayer.config;

import jakarta.validation.ConstraintViolationException;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

/**
 * Global exception handler for REST controllers.
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(ConstraintViolationException.class)
    public ResponseEntity<String> handleConstraintViolation(ConstraintViolationException ex) {
        log.warn("Validation error: {}", ex.getMessage());
        return ResponseEntity.badRequest().body("Validation error: " + ex.getMessage());
    }

    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity<String> handleIllegalArgument(IllegalArgumentException ex) {
        log.warn("Invalid argument: {}", ex.getMessage());
        return ResponseEntity.badRequest().body("Invalid argument: " + ex.getMessage());
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<String> handleGenericException(Exception ex) {
        log.error("Unexpected error: {}", ex.getMessage(), ex);
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body("Internal server error");
    }
}
```

#### Task 3.4: Add CORS Configuration (if needed)

**File**: `orchestration-layer/src/main/java/com/quizfun/orchestrationlayer/config/WebConfig.java`

```java
package com.quizfun.orchestrationlayer.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * Web MVC configuration including CORS settings.
 */
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
                .allowedOrigins("http://localhost:3000") // Frontend origin
                .allowedMethods("GET", "POST", "PUT", "DELETE", "PATCH")
                .allowedHeaders("*")
                .allowCredentials(true);
    }
}
```

#### Task 3.5: Run All Tests with Coverage

```bash
mvn clean verify
```

Verify:
- ✅ All tests pass across all modules
- ✅ JaCoCo coverage > 70%

#### Task 3.6: Run Application and Test Manually

```bash
mvn spring-boot:run -pl orchestration-layer
```

Test with curl:
```bash
# Basic query
curl "http://localhost:8765/api/v1/users/12345/question-banks/67890/questions?page=0&size=20"

# With filters
curl "http://localhost:8765/api/v1/users/12345/question-banks/67890/questions?categories=Math&tags=algebra&page=0&size=10"

# With search
curl "http://localhost:8765/api/v1/users/12345/question-banks/67890/questions?searchText=equation&page=0&size=10"
```

---

## Definition of Done

- [ ] GET endpoint created with correct URL pattern
- [ ] Controller accepts all query parameters
- [ ] Controller uses mediator for query routing
- [ ] Returns 200 OK with data (or empty list)
- [ ] Returns 400 BAD REQUEST for validation errors
- [ ] Returns 500 for unexpected errors
- [ ] All controller tests pass (14 tests)
- [ ] Request validation annotations applied
- [ ] OpenAPI documentation added
- [ ] Exception handler configured
- [ ] CORS configured (if needed)
- [ ] JaCoCo coverage >= 70%
- [ ] Allure annotations correctly applied
- [ ] Manual testing completed
- [ ] Code reviewed and approved

---

## Testing Checklist

### Integration Tests
- [ ] ✅ Return 200 OK with questions and pagination
- [ ] ✅ Filter by categories
- [ ] ✅ Filter by tags
- [ ] ✅ Filter by quizzes
- [ ] ✅ Search by text
- [ ] ✅ Combine multiple filters
- [ ] ✅ Return 200 OK with empty list (no 404)
- [ ] ✅ Support pagination
- [ ] ✅ Sort by createdAt
- [ ] ✅ Sort by questionText
- [ ] ✅ Use default values
- [ ] ✅ Return 400 for invalid page
- [ ] ✅ Return 400 for invalid size
- [ ] ✅ Include all question fields

### Manual Tests
- [ ] Test with Postman/curl
- [ ] Verify response format
- [ ] Test all filter combinations
- [ ] Test pagination edge cases
- [ ] Test error scenarios

---

## Estimated Effort

- **RED Phase**: 2.5 hours
- **GREEN Phase**: 1.5 hours
- **REFACTOR Phase**: 2 hours
- **Total**: 6 hours

---

## Dependencies

- **1010-1016**: All previous user stories (complete stack)
- **orchestration-layer**: Spring Boot web application
- **global-shared-library**: Mediator pattern

---

## Notes

### REST API Design Decisions

1. **URL Pattern**: `/api/v1/users/{userId}/question-banks/{questionBankId}/questions`
   - RESTful nested resource pattern
   - Version prefix for API evolution

2. **HTTP Method**: GET (idempotent, cacheable)

3. **Query Parameters**: All filters are optional
   - Allows flexible querying
   - Defaults provide sensible behavior

4. **Response Codes**:
   - 200 OK: Success (including empty results)
   - 400 BAD REQUEST: Client error (validation)
   - 500 INTERNAL SERVER ERROR: Server error

5. **No 404 for Empty Results**: Empty list is a valid response, not an error

### API Contract Example

**Request:**
```
GET /api/v1/users/12345/question-banks/67890/questions?categories=Math&tags=algebra&page=0&size=10&sortBy=createdAt&sortDirection=desc
```

**Response (200 OK):**
```json
{
  "questions": [
    {
      "questionId": 1234567890123,
      "questionText": "Solve for x: 2x + 5 = 15",
      "questionType": "MCQ",
      "difficultyLevel": "EASY",
      "typeSpecificData": {
        "options": ["5", "10", "15"],
        "correctAnswer": "5"
      },
      "taxonomy": {
        "categories": ["Math", "Algebra"],
        "tags": ["algebra", "equations"],
        "quizzes": ["midterm-2024"]
      },
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "pagination": {
    "currentPage": 0,
    "pageSize": 10,
    "totalItems": 42,
    "totalPages": 5
  }
}
```
