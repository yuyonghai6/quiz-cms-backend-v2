# GET Quiz Assembly by ID - API Documentation

## Endpoint Overview

**Endpoint**: `GET /api/users/{userId}/questionbanks/{questionbankId}/quiz-assemblies/{quizAssemblyId}`

**Purpose**: Retrieve a complete quiz assembly including all embedded question snapshots and metadata

**Authentication**: Required (JWT token)

**Authorization**: User can only access quiz assemblies within their own question banks

## Request Specification

### HTTP Method
```
GET
```

### URL Structure
```
/api/users/{userId}/questionbanks/{questionbankId}/quiz-assemblies/{quizAssemblyId}
```

### Path Parameters

| Parameter | Type | Format | Required | Description |
|-----------|------|--------|----------|-------------|
| `userId` | Long | Numeric | Yes | Unique identifier of the user |
| `questionbankId` | String | UUID v7 | Yes | Unique identifier of the question bank |
| `quizAssemblyId` | String | UUID v7 | Yes | Unique identifier of the quiz assembly |

#### Parameter Validation Rules

**userId**:
- Must be a positive Long value
- Must match the authenticated user's ID
- Example: `12345`

**questionbankId**:
- Must be a valid UUID v7 format
- Format: `018f-xxxx-xxxx-xxxx-xxxxxxxxxxxx`
- Must belong to the specified user
- Example: `018f-a1b2-c3d4-e5f6-123456789abc`

**quizAssemblyId**:
- Must be a valid UUID v7 format
- Format: `018f-xxxx-xxxx-xxxx-xxxxxxxxxxxx`
- Must exist within the specified question bank
- Example: `018f-b2c3-d4e5-f6a7-234567890def`

### Headers

| Header | Value | Required | Description |
|--------|-------|----------|-------------|
| `Authorization` | `Bearer {jwt_token}` | Yes | JWT authentication token |
| `Accept` | `application/json` | No | Response content type (default) |

### Query Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `include_archived` | Boolean | `false` | Include archived quiz assemblies |
| `include_statistics` | Boolean | `true` | Include calculated statistics |

#### Query Parameter Examples
```
GET /api/users/12345/questionbanks/018f-a1b2-c3d4-e5f6-123456789abc/quiz-assemblies/018f-b2c3-d4e5-f6a7-234567890def

GET /api/users/12345/questionbanks/018f-a1b2-c3d4-e5f6-123456789abc/quiz-assemblies/018f-b2c3-d4e5-f6a7-234567890def?include_archived=true

GET /api/users/12345/questionbanks/018f-a1b2-c3d4-e5f6-123456789abc/quiz-assemblies/018f-b2c3-d4e5-f6a7-234567890def?include_statistics=false
```

## Response Specification

### Success Response (HTTP 200)

**Content-Type**: `application/json`

**Response Structure**:
```json
{
  "success": true,
  "data": {
    "quiz_assembly_id": "string",
    "user_id": "number",
    "question_bank_id": "string",
    "quiz_metadata": "object",
    "assembled_questions": "array",
    "assembly_settings": "object",
    "metadata": "object",
    "statistics": "object",
    "created_at": "string",
    "updated_at": "string",
    "archived_at": "string|null"
  },
  "error": null
}
```

#### Response Field Descriptions

**quiz_assembly_id** (String):
- UUID v7 identifier of the quiz assembly
- Example: `"018f-b2c3-d4e5-f6a7-234567890def"`

**user_id** (Number):
- Long identifier of the owning user
- Example: `12345`

**question_bank_id** (String):
- UUID v7 identifier of the parent question bank
- Example: `"018f-a1b2-c3d4-e5f6-123456789abc"`

**quiz_metadata** (Object):
```json
{
  "title": "string",
  "description": "string",
  "total_points": "number",
  "estimated_duration_minutes": "number",
  "question_count": "number",
  "difficulty_distribution": {
    "easy": "number",
    "medium": "number",
    "hard": "number"
  }
}
```

**assembled_questions** (Array):
- Array of question objects with embedded snapshots
- Each question includes:
  - `source_question_id`: Original question identifier
  - `display_order`: Position in quiz sequence
  - `points`: Effective points (including overrides)
  - `question_snapshot`: Complete question data at assembly time

**assembly_settings** (Object):
```json
{
  "randomize_question_order": "boolean",
  "allow_navigation": "boolean",
  "allow_review": "boolean",
  "time_limit_minutes": "number",
  "auto_submit_on_timeout": "boolean",
  "show_progress_indicator": "boolean",
  "allow_question_skipping": "boolean",
  "require_all_questions_attempted": "boolean"
}
```

**metadata** (Object):
```json
{
  "created_by": "number",
  "last_modified_by": "number",
  "version": "number",
  "assembly_source": "string",
  "original_question_count": "number",
  "last_question_sync": "string",
  "is_template": "boolean",
  "template_category": "string|null"
}
```

**statistics** (Object):
```json
{
  "average_time_per_question": "number",
  "complexity_score": "number",
  "topic_coverage": [
    {
      "topic": "string",
      "question_count": "number"
    }
  ]
}
```

#### Complete Response Example
See `4.1.quiz-assembly_by_quiz_id.json` for a comprehensive response example.

### Error Responses

#### 400 Bad Request
**Scenario**: Invalid path parameters or malformed request

```json
{
  "success": false,
  "data": null,
  "error": {
    "code": "INVALID_REQUEST",
    "message": "Invalid quiz assembly ID format",
    "details": {
      "field": "quizAssemblyId",
      "provided_value": "invalid-uuid",
      "expected_format": "UUID v7 (018f-xxxx-xxxx-xxxx-xxxxxxxxxxxx)",
      "timestamp": "2025-09-29T10:30:00Z"
    }
  }
}
```

#### 401 Unauthorized
**Scenario**: Missing or invalid authentication token

```json
{
  "success": false,
  "data": null,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Authentication required",
    "details": {
      "reason": "Missing or invalid JWT token",
      "timestamp": "2025-09-29T10:30:00Z"
    }
  }
}
```

#### 403 Forbidden
**Scenario**: User doesn't own the question bank or quiz assembly

```json
{
  "success": false,
  "data": null,
  "error": {
    "code": "FORBIDDEN",
    "message": "Access denied to quiz assembly",
    "details": {
      "reason": "User does not own the specified question bank",
      "user_id": 12345,
      "question_bank_id": "018f-a1b2-c3d4-e5f6-123456789abc",
      "timestamp": "2025-09-29T10:30:00Z"
    }
  }
}
```

#### 404 Not Found
**Scenario**: Quiz assembly doesn't exist or is archived (when include_archived=false)

```json
{
  "success": false,
  "data": null,
  "error": {
    "code": "NOT_FOUND",
    "message": "Quiz assembly not found",
    "details": {
      "quiz_assembly_id": "018f-b2c3-d4e5-f6a7-234567890def",
      "question_bank_id": "018f-a1b2-c3d4-e5f6-123456789abc",
      "user_id": 12345,
      "timestamp": "2025-09-29T10:30:00Z"
    }
  }
}
```

#### 500 Internal Server Error
**Scenario**: Database connection failure or unexpected system error

```json
{
  "success": false,
  "data": null,
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "Service temporarily unavailable",
    "details": {
      "reason": "Database connection failed",
      "retry_after": "5 minutes",
      "timestamp": "2025-09-29T10:30:00Z"
    }
  }
}
```

## Usage Examples

### Basic Quiz Assembly Retrieval

**Request**:
```http
GET /api/users/12345/questionbanks/018f-a1b2-c3d4-e5f6-123456789abc/quiz-assemblies/018f-b2c3-d4e5-f6a7-234567890def HTTP/1.1
Host: quiz-cms-api.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Accept: application/json
```

**Response**:
```http
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: private, max-age=300

{
  "success": true,
  "data": {
    "quiz_assembly_id": "018f-b2c3-d4e5-f6a7-234567890def",
    "quiz_metadata": {
      "title": "JavaScript Fundamentals Assessment",
      "total_points": 95
    },
    // ... complete response data
  },
  "error": null
}
```

### Include Archived Quiz Assembly

**Request**:
```http
GET /api/users/12345/questionbanks/018f-a1b2-c3d4-e5f6-123456789abc/quiz-assemblies/018f-b2c3-d4e5-f6a7-234567890def?include_archived=true HTTP/1.1
Host: quiz-cms-api.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Exclude Statistics for Performance

**Request**:
```http
GET /api/users/12345/questionbanks/018f-a1b2-c3d4-e5f6-123456789abc/quiz-assemblies/018f-b2c3-d4e5-f6a7-234567890def?include_statistics=false HTTP/1.1
Host: quiz-cms-api.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Implementation Details

### CQRS Query Handler

The endpoint uses the CQRS pattern with the following query:

```java
public record GetQuizAssemblyByIdQuery(
    Long userId,
    String questionBankId,
    String quizAssemblyId,
    Boolean includeArchived,
    Boolean includeStatistics
) implements IQuery<QuizAssemblyResponseDto> {}
```

### Security Validation

1. **Authentication**: JWT token validation
2. **Authorization**: User ownership verification
3. **Data Isolation**: Multi-tenant filtering by user_id and question_bank_id

### Performance Considerations

1. **Single Query**: Complete data retrieved in one MongoDB query
2. **No Joins**: Question snapshots eliminate need for question-bank queries
3. **Caching**: Response cacheable for 5 minutes (private cache)
4. **Selective Fields**: Statistics can be excluded for faster response

### Database Query

The implementation uses the following MongoDB query pattern:

```javascript
db.quiz_assemblies.findOne({
  user_id: 12345,
  question_bank_id: "018f-a1b2-c3d4-e5f6-123456789abc",
  quiz_assembly_id: "018f-b2c3-d4e5-f6a7-234567890def",
  archived_at: includeArchived ? { $exists: true } : null
});
```

## Client Integration Guidelines

### Error Handling

Clients should handle the following error scenarios:

1. **Network Errors**: Implement retry logic with exponential backoff
2. **Authentication Errors**: Redirect to login and refresh tokens
3. **Authorization Errors**: Display access denied message
4. **Not Found Errors**: Handle missing quiz assemblies gracefully
5. **Server Errors**: Show temporary unavailability message

### Caching Strategy

- **Cache Duration**: 5 minutes for successful responses
- **Cache Key**: Include user_id, question_bank_id, and quiz_assembly_id
- **Invalidation**: Clear cache on quiz assembly updates

### Response Processing

```typescript
interface QuizAssemblyResponse {
  success: boolean;
  data: QuizAssembly | null;
  error: ApiError | null;
}

interface QuizAssembly {
  quiz_assembly_id: string;
  user_id: number;
  question_bank_id: string;
  quiz_metadata: QuizMetadata;
  assembled_questions: AssembledQuestion[];
  assembly_settings: AssemblySettings;
  metadata: AssemblyMetadata;
  statistics?: AssemblyStatistics;
  created_at: string;
  updated_at: string;
  archived_at?: string;
}
```

## Rate Limiting

- **Limit**: 100 requests per minute per user
- **Headers**: Rate limit information included in response headers
- **Exceeded**: HTTP 429 Too Many Requests

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1696000000
```

This API provides comprehensive access to quiz assembly data with robust error handling, security validation, and performance optimization.